<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ù…Ù†ØµØ© Ù„ØºØªÙŠ Ù‡ÙˆÙŠØªÙŠ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        :root { 
            --main: #4a90e2; --sec: #2ecc71; --vocab: #9b59b6; 
            --video: #e67e22; --err: #e74c3c; --bg: #f4f7f6; 
            --white: #ffffff; --text: #2d3436; 
        }
        * { box-sizing: border-box; transition: 0.3s; font-family: 'Cairo', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 20px; min-height: 100vh; }
        .container { 
            width: 100%; max-width: 950px; background: var(--white); 
            border-radius: 30px; padding: 30px; margin: 0 auto; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); 
        }
        h2, h3 { color: var(--main); font-weight: 900; margin-top: 0; }
        input, select, textarea { 
            width: 100%; padding: 12px; margin: 8px 0; 
            border: 1px solid #cbd5e1; border-radius: 12px; 
            font-size: 15px; outline: none; display: block; 
        }
        input:focus, select:focus, textarea:focus { border-color: var(--main); }
        .btn { width: 100%; padding: 12px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; margin-bottom: 10px; color: white; font-size: 16px; display: inline-flex; justify-content: center; align-items: center; gap: 8px; }
        .btn-main { background: var(--main); }
        .btn-sec { background: var(--sec); }
        .btn-video { background: var(--video); }
        .btn-del { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; width: auto; padding: 5px 10px; font-size: 12px; }
        .btn-edit { background: #eff6ff; color: #2563eb; border: 1px solid #dbeafe; width: auto; padding: 5px 10px; font-size: 12px; margin-left: 5px; }
        .btn-outline { background: #fff; border: 2px solid #e2e8f0; color: #64748b; }
        .admin-nav { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 25px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        .admin-nav button { flex: 1; min-width: 100px; font-size: 14px; margin: 0; border-radius: 20px; }
        .admin-tab { display: none; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 10000; display: flex; justify-content: center; align-items: center; }
        #login-box { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); width: 90%; max-width: 400px; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; font-size: 14px; }
        th { background: #f1f5f9; color: var(--main); }
        .bulk-area { background: #f0f9ff; padding: 15px; border-radius: 12px; border: 2px dashed #bae6fd; margin: 15px 0; }
        .manage-filter-bar { display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .manage-filter-btn { background: #fff; border: 1px solid #ccc; padding: 6px 15px; border-radius: 20px; cursor: pointer; white-space: nowrap; }
        .manage-filter-btn.active { background: var(--main); color: white; border-color: var(--main); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 20000; justify-content: center; align-items: center; padding: 15px; }
        .modal-content { background: white; width: 100%; max-width: 600px; border-radius: 20px; padding: 25px; }
        #global-loader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 30000; justify-content: center; align-items: center; }
        .spinner { width: 50px; height: 50px; border: 5px solid #eee; border-top-color: var(--main); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to {transform: rotate(360deg);} }
    </style>
</head>
<body>
    <div id="global-loader"><div class="spinner"></div></div>

    <div id="login-overlay">
        <div id="login-box">
            <img src="https://cdn-icons-png.flaticon.com/512/3426/3426653.png" width="80" style="margin-bottom:20px;">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
            <input type="email" id="adm-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="adm-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="btn btn-main" onclick="adminLogin()">Ø¯Ø®ÙˆÙ„</button>
            <p style="margin-top:15px; font-size:13px; color:#888;">Ù…Ù†ØµØ© Ù„ØºØªÙŠ Ù‡ÙˆÙŠØªÙŠ - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
        </div>
    </div>

    <div class="container" id="admin-panel" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø© âš™ï¸</h2>
            <a href="index.html" target="_blank" class="btn btn-outline" style="width: auto; padding: 8px 15px;">Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø·Ø§Ù„Ø¨ <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="admin-nav">
            <button class="btn btn-main" onclick="showTab('tab-q')">Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¦Ù„Ø©</button>
            <button class="btn btn-sec" onclick="showTab('tab-l')">Ø§Ù„Ù…ÙƒØªØ¨Ø©</button>
            <button class="btn btn-video" onclick="showTab('tab-v')">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</button>
            <button class="btn btn-outline" onclick="showTab('tab-mng'); loadManageData('all');">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
            <button class="btn btn-outline" onclick="showTab('tab-results'); loadStudentResults();" style="border-color:var(--sec); color:var(--sec);">ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button class="btn btn-outline" onclick="showTab('tab-settings')" style="border-color:#4a90e2; color:#4a90e2;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
            <button class="btn btn-outline" onclick="adminLogout()" style="border-color:#e74c3c; color:#e74c3c; flex: 0;">Ø®Ø±ÙˆØ¬</button>
        </div>

        <div id="tab-q" class="admin-tab" style="display: block;">
            <h3>Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ùƒ Ø£Ø³Ø¦Ù„Ø©</h3>
            <div style="background:#fff; padding:15px; border-radius:15px; border:1px solid #eee;">
                <select id="in-q-grade">
                    <option value="4">Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option><option value="5">Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option><option value="6">Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
                    <option value="7">Ø£ÙˆÙ„ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option><option value="8">Ø«Ø§Ù†ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option><option value="9">Ø«Ø§Ù„Ø« Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
                </select>
                <select id="in-q-type"><option value="grammar">Ù†Ø­Ùˆ</option><option value="vocab">Ù…ÙØ±Ø¯Ø§Øª</option></select>
                <select id="in-q-month">
                    <option value="Ø´Ø§Ù…Ù„">Ø´Ø§Ù…Ù„</option>
                    <option value="Ø£ÙƒØªÙˆØ¨Ø±">Ø£ÙƒØªÙˆØ¨Ø±</option><option value="Ù†ÙˆÙÙ…Ø¨Ø±">Ù†ÙˆÙÙ…Ø¨Ø±</option><option value="Ø¯ÙŠØ³Ù…Ø¨Ø±">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
                    <option value="ÙØ¨Ø±Ø§ÙŠØ±">ÙØ¨Ø±Ø§ÙŠØ±</option><option value="Ù…Ø§Ø±Ø³">Ù…Ø§Ø±Ø³</option><option value="Ø£Ø¨Ø±ÙŠÙ„">Ø£Ø¨Ø±ÙŠÙ„</option>
                </select>
            </div>
            
            <div class="bulk-area">
                <b>ğŸš€ Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ø¬Ù…Ø¹ (JSON):</b>
                <textarea id="in-bulk" rows="5" placeholder="[{&quot;q&quot;:&quot;Ø³Ø¤Ø§Ù„1&quot;, &quot;c&quot;:&quot;ØµØ­&quot;, &quot;w&quot;:[&quot;Ø®Ø·Ø£1&quot;,&quot;Ø®Ø·Ø£2&quot;,&quot;Ø®Ø·Ø£3&quot;], &quot;rule&quot;:&quot;Ù‚Ø§Ø¹Ø¯Ø©&quot;}, ...]"></textarea>
                <button class="btn btn-main" onclick="saveBulk()">Ø±ÙØ¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
            </div>
            
            <div style="margin-top:15px; border-top:1px solid #ddd; padding-top:10px;">
                <b>Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯:</b>
                <input id="in-q-txt" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„">
                <input id="in-q-c" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©">
                <input id="in-q-w1" placeholder="Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© 1">
                <input id="in-q-w2" placeholder="Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© 2">
                <input id="in-q-rule" placeholder="Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                <button class="btn btn-sec" onclick="saveSingleQ()">Ø­ÙØ¸ Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯</button>
            </div>
        </div>

        <div id="tab-l" class="admin-tab">
            <h3>Ù†Ø´Ø± Ø¯Ø±Ø³ ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø©</h3>
            <select id="in-l-grade"><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option></select>
            <input id="in-l-tit" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³">
            <textarea id="in-l-bod" rows="6" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø´Ø±Ø­..."></textarea>
            <input id="in-l-img" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <button class="btn btn-sec" onclick="saveLesson()">Ù†Ø´Ø± Ø§Ù„Ø¯Ø±Ø³</button>
        </div>

        <div id="tab-v" class="admin-tab">
            <h3>Ù†Ø´Ø± ÙÙŠØ¯ÙŠÙˆ ØªØ¹Ù„ÙŠÙ…ÙŠ</h3>
            <select id="in-v-grade"><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option></select>
            <input id="v-tit" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
            <input id="v-url" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ Ø£Ùˆ ØªÙŠÙƒ ØªÙˆÙƒ">
            <button class="btn btn-video" onclick="saveVideo()">Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>
        </div>

        <div id="tab-mng" class="admin-tab">
            <h3>Ø¥Ø¯Ø§Ø±Ø© ÙˆØ­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3>
            <div class="manage-filter-bar">
                <button class="manage-filter-btn active" onclick="loadManageData('all', this)">Ø§Ù„ÙƒÙ„</button>
                <button class="manage-filter-btn" onclick="loadManageData('questions', this)">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
                <button class="manage-filter-btn" onclick="loadManageData('lessons', this)">Ø§Ù„Ø¯Ø±ÙˆØ³</button>
                <button class="manage-filter-btn" onclick="loadManageData('videos', this)">Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</button>
            </div>
            <div id="mng-list" style="max-height:450px; overflow-y:auto; background:white; padding:10px; border-radius:10px; border:1px solid #ddd;"></div>
        </div>

        <div id="tab-results" class="admin-tab">
            <h3>Ø³Ø¬Ù„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ğŸ†</h3>
            <button class="btn btn-del" onclick="clearResults()" style="float:left; width:auto; margin-bottom:10px;"><i class="fas fa-trash"></i> Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
            <div style="overflow-x:auto;">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th>Ø­Ø°Ù</th>
                        </tr>
                    </thead>
                    <tbody id="results-body"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-settings" class="admin-tab">
            <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø§Ù…Ø© ğŸ› ï¸</h3>
            <div style="background:#f0f7ff; padding:15px; border-radius:15px; border:1px solid #4a90e2; margin-bottom:15px;">
                <b>ğŸ“ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:</b>
                <input type="text" id="set-title" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØµØ©">
                <input type="text" id="set-subtitle" placeholder="ÙˆØµÙ Ù‚ØµÙŠØ±">
                <input type="text" id="set-logo" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø±">
                <input type="text" id="set-welcome-msg" placeholder="Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨">
            </div>
            <div style="background:#f0fdf4; padding:15px; border-radius:15px; border:1px solid #2ecc71; margin-bottom:15px;">
                <b>ğŸ”— Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„:</b>
                <input type="text" id="set-wa" placeholder="ÙˆØ§ØªØ³Ø§Ø¨">
                <input type="text" id="set-tele" placeholder="ØªÙ„ÙŠØ¬Ø±Ø§Ù…">
                <input type="text" id="set-face" placeholder="ÙÙŠØ³Ø¨ÙˆÙƒ">
                <input type="text" id="set-tiktok" placeholder="ØªÙŠÙƒ ØªÙˆÙƒ">
            </div>
            <div style="background:#fff7ed; padding:15px; border-radius:15px; border:1px solid #e67e22;">
                <b>ğŸ“² Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª:</b>
                <input type="text" id="admin-app-url" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                <label style="display:block; margin:10px 0;"><input type="checkbox" id="admin-show-banner" style="width:auto; display:inline;"> ØªÙØ¹ÙŠÙ„ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ø¯ÙŠØ«</label>
                <input type="text" id="admin-update-msg" placeholder="Ù†Øµ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«">
            </div>
            <button class="btn btn-main" onclick="saveSiteSettings()">Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>
    </div>

    <div id="modal-edit" class="modal">
        <div class="modal-content">
            <span onclick="document.getElementById('modal-edit').style.display='none'" style="float:left; cursor:pointer; font-size:30px;">Ã—</span>
            <h3>ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ†Ù‚Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3>
            <input type="hidden" id="edit-id"><input type="hidden" id="edit-col">
            <label>Ø§Ù„ØµÙ:</label>
            <select id="edit-grade"><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option></select>
            <label>Ø§Ù„Ø´Ù‡Ø± (Ù„Ù„Ø£Ø³Ø¦Ù„Ø©):</label>
            <select id="edit-month"><option value="Ø´Ø§Ù…Ù„">Ø´Ø§Ù…Ù„</option><option value="Ø£ÙƒØªÙˆØ¨Ø±">Ø£ÙƒØªÙˆØ¨Ø±</option><option value="Ù†ÙˆÙÙ…Ø¨Ø±">Ù†ÙˆÙÙ…Ø¨Ø±</option><option value="Ø¯ÙŠØ³Ù…Ø¨Ø±">Ø¯ÙŠØ³Ù…Ø¨Ø±</option><option value="ÙØ¨Ø±Ø§ÙŠØ±">ÙØ¨Ø±Ø§ÙŠØ±</option><option value="Ù…Ø§Ø±Ø³">Ù…Ø§Ø±Ø³</option><option value="Ø£Ø¨Ø±ÙŠÙ„">Ø£Ø¨Ø±ÙŠÙ„</option></select>
            <label>Ø§Ù„Ù†ÙˆØ¹:</label>
            <select id="edit-type"><option value="grammar">Ù†Ø­Ùˆ</option><option value="vocab">Ù…ÙØ±Ø¯Ø§Øª</option></select>
            <button class="btn btn-main" onclick="saveEdit()" style="margin-top:15px;">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCgpj7MLByWpTVUE2Tg3DQ0pwsUjLhAyEM",
            authDomain: "ahmedead-5185c.firebaseapp.com",
            projectId: "ahmedead-5185c",
            storageBucket: "ahmedead-5185c.firebasestorage.app",
            messagingSenderId: "559908876854",
            appId: "1:559908876854:web:e8e7c151e984dc13219e97"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        function showLoader() { document.getElementById('global-loader').style.display = 'flex'; }
        function hideLoader() { document.getElementById('global-loader').style.display = 'none'; }
        const gradeNames = { "4": "Ø±Ø§Ø¨Ø¹ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "5": "Ø®Ø§Ù…Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "6": "Ø³Ø§Ø¯Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "7": "Ø£ÙˆÙ„ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "8": "Ø«Ø§Ù†ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "9": "Ø«Ø§Ù„Ø« Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ" };

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                loadSettings();
            } else {
                document.getElementById('login-overlay').style.display = 'flex';
                document.getElementById('admin-panel').style.display = 'none';
            }
        });

        function adminLogin() {
            const email = document.getElementById('adm-email').value;
            const pass = document.getElementById('adm-pass').value;
            showLoader();
            auth.signInWithEmailAndPassword(email, pass).then(() => {
                Swal.fire({icon:'success', title:'ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„', timer:1500, showConfirmButton:false});
            }).catch((e) => {
                Swal.fire({icon:'error', title:'Ø®Ø·Ø£', text:'ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±'});
            }).finally(() => hideLoader());
        }

        function adminLogout() { auth.signOut().then(() => location.reload()); }
        function showTab(id) { document.querySelectorAll('.admin-tab').forEach(t => t.style.display = 'none'); document.getElementById(id).style.display = 'block'; }

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­ÙØ¸ ---
        function saveSingleQ() {
            db.collection("questions").add({
                grade: document.getElementById('in-q-grade').value, type: document.getElementById('in-q-type').value, month: document.getElementById('in-q-month').value,
                q: document.getElementById('in-q-txt').value, c: document.getElementById('in-q-c').value,
                w: [document.getElementById('in-q-w1').value, document.getElementById('in-q-w2').value, "Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©"],
                rule: document.getElementById('in-q-rule').value
            }).then(() => {
                Swal.fire('ØªÙ… Ø§Ù„Ø­ÙØ¸', '', 'success');
                document.getElementById('in-q-txt').value = '';
            }).catch(e => alert("Ø®Ø·Ø£"));
        }

        function saveBulk() {
            try {
                const data = JSON.parse(document.getElementById('in-bulk').value);
                const grade = document.getElementById('in-q-grade').value;
                const type = document.getElementById('in-q-type').value;
                const month = document.getElementById('in-q-month').value;
                const batch = db.batch();
                data.forEach(q => { const ref = db.collection("questions").doc(); batch.set(ref, { ...q, grade, type, month }); });
                batch.commit().then(() => Swal.fire('ØªÙ… Ø§Ù„Ø±ÙØ¹!', '', 'success'));
            } catch(e) { Swal.fire('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ JSON', '', 'error'); }
        }

        function saveLesson() {
            db.collection("lessons").add({ 
                grade: document.getElementById('in-l-grade').value, title: document.getElementById('in-l-tit').value, body: document.getElementById('in-l-bod').value, img: document.getElementById('in-l-img').value 
            }).then(() => Swal.fire('ØªÙ… Ø§Ù„Ù†Ø´Ø±', '', 'success')).catch(e => alert("Ø®Ø·Ø£"));
        }

        function saveVideo() {
            db.collection("videos").add({ 
                grade: document.getElementById('in-v-grade').value, title: document.getElementById('v-tit').value, url: document.getElementById('v-url').value 
            }).then(() => Swal.fire('ØªÙ… Ø§Ù„Ù†Ø´Ø±', '', 'success')).catch(e => alert("Ø®Ø·Ø£"));
        }

        // --- Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ---
        function loadManageData(type, btn) {
            if(btn) { document.querySelectorAll('.manage-filter-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
            const list = document.getElementById('mng-list');
            list.innerHTML = '<p style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¬Ù„Ø¨...</p>';
            let items = [];
            
            // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const promises = [];
            if(type === 'all' || type === 'questions') promises.push(db.collection("questions").get().then(s => s.forEach(d => items.push({id: d.id, ...d.data(), col:'questions', lbl:'Ø³Ø¤Ø§Ù„'}))));
            if(type === 'all' || type === 'lessons') promises.push(db.collection("lessons").get().then(s => s.forEach(d => items.push({id: d.id, ...d.data(), col:'lessons', lbl:'Ø¯Ø±Ø³'}))));
            if(type === 'all' || type === 'videos') promises.push(db.collection("videos").get().then(s => s.forEach(d => items.push({id: d.id, ...d.data(), col:'videos', lbl:'ÙÙŠØ¯ÙŠÙˆ'}))));
            
            Promise.all(promises).then(() => {
                list.innerHTML = items.length ? items.map(i => `
                    <div style="display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #eee; margin-bottom:5px;">
                        <div><b>${(i.q || i.title || "").substring(0,40)}</b> <span style="font-size:12px; color:#888;">(${i.lbl} - ${gradeNames[i.grade] || i.grade})</span></div>
                        <div>
                            <button class="btn-edit" onclick="openEditModal('${i.id}','${i.col}','${i.grade}','${i.month||''}','${i.type||''}')"><i class="fas fa-pen"></i></button>
                            <button class="btn-del" onclick="delDoc('${i.col}','${i.id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`).join('') : '<p style="text-align:center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰</p>';
            });
        }

        function delDoc(c, id) { if(confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) { db.collection(c).doc(id).delete().then(() => loadManageData('all')); } }
        
        function openEditModal(id, c, g, m, t) {
            document.getElementById('edit-id').value = id; document.getElementById('edit-col').value = c;
            document.getElementById('edit-grade').value = g;
            if(m) document.getElementById('edit-month').value = m;
            if(t) document.getElementById('edit-type').value = t;
            document.getElementById('modal-edit').style.display = 'flex';
        }

        function saveEdit() {
            const id = document.getElementById('edit-id').value; const col = document.getElementById('edit-col').value;
            db.collection(col).doc(id).update({
                grade: document.getElementById('edit-grade').value,
                month: document.getElementById('edit-month').value,
                type: document.getElementById('edit-type').value
            }).then(() => {
                document.getElementById('modal-edit').style.display = 'none';
                Swal.fire('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„', '', 'success'); loadManageData('all');
            });
        }

        // --- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ---
        function loadStudentResults() {
            const tbody = document.getElementById('results-body');
            tbody.innerHTML = '<tr><td colspan="6">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
            db.collection("results").get().then(snap => {
                let docs = [];
                snap.forEach(d => docs.push({id: d.id, ...d.data()}));
                docs.sort((a,b) => new Date(b.date) - new Date(a.date));
                tbody.innerHTML = docs.map(r => `<tr>
                        <td>${r.date}</td><td>${r.name}</td><td>${gradeNames[r.grade]}</td><td>${r.examType}</td>
                        <td style="color:${(r.score/r.total)>=0.7?'green':'red'}">${r.score}/${r.total}</td>
                        <td><button class="btn-del" onclick="delRes('${r.id}')"><i class="fas fa-trash"></i></button></td>
                    </tr>`).join('') || '<tr><td colspan="6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</td></tr>';
            });
        }

        function delRes(id) { if(confirm("Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù†ØªÙŠØ¬Ø©ØŸ")) { db.collection("results").doc(id).delete().then(() => loadStudentResults()); } }
        
        function clearResults() {
            if(confirm("Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
                db.collection("results").get().then(snap => {
                    const batch = db.batch();
                    snap.forEach(d => batch.delete(d.ref));
                    batch.commit().then(() => loadStudentResults());
                });
            }
        }

        // --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ---
        function loadSettings() {
            db.collection("settings").doc("site_info").get().then(s => {
                if(s.exists) {
                    const d = s.data();
                    document.getElementById('set-title').value = d.title || "";
                    document.getElementById('set-subtitle').value = d.subtitle || "";
                    document.getElementById('set-logo').value = d.logo || "";
                    document.getElementById('set-welcome-msg').value = d.welcome || "";
                    document.getElementById('set-wa').value = d.wa || "";
                    document.getElementById('set-tele').value = d.tele || "";
                    document.getElementById('set-face').value = d.face || "";
                    document.getElementById('set-tiktok').value = d.tiktok || "";
                }
            });
            db.collection("settings").doc("app_config").get().then(a => {
                if(a.exists) {
                    const d = a.data();
                    document.getElementById('admin-app-url').value = d.download_url || "";
                    document.getElementById('admin-show-banner').checked = d.show_banner || false;
                    document.getElementById('admin-update-msg').value = d.update_msg || "";
                }
            });
        }

        function saveSiteSettings() {
            showLoader();
            let wa = document.getElementById('set-wa').value;
            if(wa && !wa.startsWith('http')) wa = `https://wa.me/20${wa.replace(/^0+/,'')}`;
            
            const batch = db.batch();
            batch.set(db.collection("settings").doc("site_info"), {
                title: document.getElementById('set-title').value,
                subtitle: document.getElementById('set-subtitle').value,
                logo: document.getElementById('set-logo').value,
                welcome: document.getElementById('set-welcome-msg').value,
                wa: wa,
                tele: document.getElementById('set-tele').value,
                face: document.getElementById('set-face').value,
                tiktok: document.getElementById('set-tiktok').value
            }, {merge: true});

            batch.set(db.collection("settings").doc("app_config"), {
                download_url: document.getElementById('admin-app-url').value,
                show_banner: document.getElementById('admin-show-banner').checked,
                update_msg: document.getElementById('admin-update-msg').value
            }, {merge: true});

            batch.commit().then(() => Swal.fire('ØªÙ… Ø§Ù„Ø­ÙØ¸', '', 'success')).finally(() => hideLoader());
        }
    </script>

</body></html>